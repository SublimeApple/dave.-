<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        $80M Available to Withdraw ::
        dave&#39;s site
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="It&amp;rsquo;s Friday, 24th of June. Not only is it the last day of the week - but tomorrow it&amp;rsquo;s my birthday - hurah!
I need to submit some important proposals at DXdao, but our UIs are down. Alchemy seems to have some subgraph sync issues and DXvote doesn&amp;rsquo;t load at all. Ugh - I don&amp;rsquo;t want to delay this to the weekend &amp;ndash; did I mention already tomorrow is my birthday?"
/>
<meta
  name="keywords"
  content="dave davide montali davebit"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://dave.xn--tckwe/posts/exploit/" />





<link rel="stylesheet" href="https://dave.xn--tckwe/assets/style.css" />

<link rel="stylesheet" href="https://dave.xn--tckwe/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="https://dave.xn--tckwe/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="https://dave.xn--tckwe/img/favicon.png" />


<link href="https://dave.xn--tckwe/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://dave.xn--tckwe/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://dave.xn--tckwe/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://dave.xn--tckwe/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://dave.xn--tckwe/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://dave.xn--tckwe/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://dave.xn--tckwe/img/usd.png"/>

<meta name="twitter:title" content="$80M Available to Withdraw"/>
<meta name="twitter:description" content="Holy smokes. Periods are multipliers?! Let’s dig in…"/>
<meta name="twitter:site" content="@davebit_"/>



<meta property="og:title" content="$80M Available to Withdraw" />
<meta property="og:description" content="Holy smokes. Periods are multipliers?! Let’s dig in…" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dave.xn--tckwe/posts/exploit/" /><meta property="og:image" content="https://dave.xn--tckwe/img/usd.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-20T08:00:00-05:00" />
<meta property="article:modified_time" content="2022-10-20T08:00:00-05:00" /><meta property="og:site_name" content="dave&#39;s site" />







  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >dave</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">$80M Available to Withdraw</h1>
    <div class="post-meta">
      
        <span class="post-date">
          Thursday, 20 Oct, 2022
        </span>

        
          
        
      

      
        <span class="post-author"
          >— Written by Dave</span
        >


      
    </div>

    

    
      <figure class="post-cover">
  
    <img src="https://dave.xn--tckwe/img/usd.png" alt="$80M Available to Withdraw"/>
  

  
</figure>

    

    <div class="post-content">
      
      <p>It&rsquo;s Friday, 24th of June. Not only is it the last day of the week - but tomorrow it&rsquo;s my birthday - hurah!</p>
<p>I need to submit some important proposals at DXdao, but our UIs are down. Alchemy seems to have some subgraph sync issues and DXvote doesn&rsquo;t load at all. Ugh - I don&rsquo;t want to delay this to the weekend &ndash; did I mention already tomorrow is my birthday?!</p>
<p>Ok, fuck this. I&rsquo;ll submit it via CLI. Load the smart contracts locally, upload the content to IPFS locally, then build the transaction with the IPFS CID and other params, then finally submit it.</p>
<p>What smart contracts do I need? Well, 95% of DXdao proposals are done through the <a href="https://etherscan.io/address/0x08cc7bba91b849156e9c44ded51896b38400f55b#code">ContributionReward</a>. The scheme has direct access to <a href="https://etherscan.io/address/0x519b70055af55a007110b4ff99b0ea33071c720a">DXdao&rsquo;s Treasury</a> and is used for anything that involves moving money around, paying contributors, sponsorships, you name it.</p>
<p>All I want to do is submit a proposal, so I check out the <code>proposeContributionReward</code> function.</p>
<pre tabindex="0"><code>    /**
    * @dev Submit a proposal for a reward for a contribution:
    * @param _avatar Avatar of the organization that the contribution was made for
    * @param _descriptionHash A hash of the proposal&#39;s description
    * @param _reputationChange - Amount of reputation change requested .Can be negative.
    * @param _rewards rewards array:
    *         rewards[0] - Amount of tokens requested per period
    *         rewards[1] - Amount of ETH requested per period
    *         rewards[2] - Amount of external tokens requested per period
    *         rewards[3] - Period length - if set to zero it allows immediate redeeming after execution.
    *         rewards[4] - Number of periods
    * @param _externalToken Address of external token, if reward is requested there
    * @param _beneficiary Who gets the rewards
    */
    function proposeContributionReward(
        Avatar _avatar,
        string memory _descriptionHash,
        int256 _reputationChange,
        uint[5] memory _rewards,
        IERC20 _externalToken,
        address payable _beneficiary
    )
</code></pre><p>I&rsquo;m so illiterate at Solidity that I start off reading the comments (rofl - who reads comments in code). One thing that stands out immediately is that the rewards in the <code>_rewards</code> array are set &ldquo;per period&rdquo;? What does that even mean?</p>
<p>Let&rsquo;s look up where periods are - oh wait it&rsquo;s right there the last int in the <code>_rewards</code> array. I&rsquo;m confused. All proposals at DXdao are one-off proposals - or at least I (and everyone else) thought so. The UIs don&rsquo;t even display periods of a proposal, when you submit a proposal through a UI interface it defaults proposals to 1 - well let me try on override it and see what happens&hellip; <em>suspense</em> &hellip;nothing. The proposal submitted fine, the UIs (now working again ofc&hellip; after I did the whole local setup) show it as a completely normal proposal - although it has multiple periods (i.e. should be redeemable multiple times).</p>
<p>Alright, this is weird. But I guess it probably doesn&rsquo;t allow you to redeem it multiple time - that would be crazy! Enter Tenderly - one of my fav tools. Let&rsquo;s overwrite a couple of states to make the proposal appear as successfully passed and do a <a href="https://dashboard.tenderly.co/public/dxdao/dxdao-proposal-simulation/simulator/716961c7-1ccb-4acb-8dcd-5ede64f78535/logs">Tenderly Simulation</a>.</p>
<p><img src="/img/rep_mint.png" alt=""></p>
<p>Holy smokes.</p>
<p>Periods are multipliers?! Let&rsquo;s dig in&hellip;</p>
<pre tabindex="0"><code>function redeemReputation(bytes32 _proposalId, Avatar _avatar) public returns(int256 reputation) {

        uint256 periodsToPay = getPeriodsToPay(_proposalId, address(_avatar), 0);

        //set proposal reward to zero to prevent reentrancy attack.
        proposal.reputationChange = 0;
        reputation = int(periodsToPay) * _proposal.reputationChange;
</code></pre><p>Holy shit <code>int(periodsToPay) * _proposal.reputationChange;</code> periods is just a hidden multiplier?!?</p>
<p>Also while the comments of the proposeContributionReward explicitly states Native Token, ETH, and External Tokens are paid out per period. This code snippet above is REP - DXdao&rsquo;s voting token.  REP is a non-transferable ERC20 tokens (aka not an ERC20 token lol - but essentially an ERC20 token with the transfer function removed). With 51% REP you own the DAO.</p>
<p><em><strong>Could this be exploited? Well&hellip;</strong></em></p>
<p>I guess anyone submitting a proposal for payment could use a multiplier to drain funds - but it&rsquo;d be obvious who did it.</p>
<p><em><strong>Is there an anon way to exploit the funds?</strong></em></p>
<p>Here it becomes interesting - DXdao generously rewards REP to active community members, the simplest way for example is being active in the Discord channel and receiving a <a href="https://daotalk.org/t/dxdao-discord-rep-boosts-q2-2022/4331">&ldquo;REP boost&rdquo;</a>. These are small rewards payed out to active community members a lot of whom are anon. The smallest REP boost is 186 REP - is that enough to take full control of the DAO?</p>
<p><strong>Yes.</strong></p>
<p>The tenderly simulation above mints 176 REP with 100k periods - which would account for over 90% REP. Allowing the exploiter to instantly withdraw all funds in the DAO, as if it were an EOA they control.</p>
<p><em><strong>How much money was in the DAO?</strong></em></p>
<p>At the time of discovery, there were over $80M in the DAO - although a large part of those funds were native tokens. ETH + Stables alone made up $37.8M though.</p>
<p><em><strong>What happened?</strong></em></p>
<p>I reported the attack vector to the DXdao governance team immediately, on the same day an update was pushed to DXvote (the UI we control) to reflect proposals that use multiple periods and display a warning on such proposals.</p>
<p>Some more deets and forum discussion: <a href="https://daotalk.org/t/exploit-disclosure-dxdao-governance/4625">link</a></p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
            
              <span class="button next">
                <a href="https://dave.xn--tckwe/posts/reverse-engineering-hltv-rating/">
                  <span class="button__text">Reverse Engineering the HLTV 2.0 Rating</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >dave</span
    >
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span
          >© 2022 Powered by
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span
        >
        <span
          >Theme created by
          <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span
        >
      </div>
    
  </div>
</footer>

<script src="https://dave.xn--tckwe/assets/main.js"></script>
<script src="https://dave.xn--tckwe/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
